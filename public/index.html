<!DOCTYPE html>
<html>
<head>
  <title>Honest25-AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-zinc-200 min-h-screen flex flex-col">

  <div class="max-w-3xl mx-auto w-full p-6 flex-1">

    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-blue-500">HONEST25 AI</h1>
      <button onclick="clearChat()" 
        class="text-xs bg-red-600 px-3 py-1 rounded">
        Clear Chat
      </button>
    </div>

    <div id="chat" class="space-y-4 mb-24"></div>

  </div>

  <div class="fixed bottom-0 left-0 w-full bg-zinc-900 p-4">
    <div class="max-w-3xl mx-auto flex gap-2">
      <input id="input" class="flex-1 bg-black border border-zinc-700 p-3 rounded-lg"
        placeholder="Ask Honest25-AI...">
      <button onclick="send()" 
        class="bg-blue-600 px-5 rounded-lg font-bold">
        Send
      </button>
    </div>
  </div>

<script>

let messages = JSON.parse(localStorage.getItem("honest25")) || [];
render();

function save() {
  localStorage.setItem("honest25", JSON.stringify(messages));
}

function render() {
  const chat = document.getElementById("chat");
  chat.innerHTML = "";

  messages.forEach((msg, index) => {
    const div = document.createElement("div");
    div.className = "bg-zinc-900 p-4 rounded-xl relative";

    div.innerHTML = `
      <div class="text-sm opacity-70">${msg.role}</div>
      <div>${msg.content}</div>
      ${msg.model ? `<div class="text-xs text-blue-400 mt-2">Model: ${msg.model}</div>` : ""}
      <button onclick="deleteMsg(${index})"
        class="absolute top-2 right-2 text-red-500 text-xs">
        âœ•
      </button>
    `;

    chat.appendChild(div);
  });

  window.scrollTo(0, document.body.scrollHeight);
}

function deleteMsg(index) {
  messages.splice(index, 1);
  save();
  render();
}

function clearChat() {
  messages = [];
  save();
  render();
}

async function send() {
  const input = document.getElementById("input");
  const text = input.value;
  if (!text) return;

  messages.push({ role: "user", content: text });
  save();
  render();
  input.value = "";

  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages })
  });

  const data = await res.json();

  messages.push({
    role: "assistant",
    content: data.reply,
    model: data.modelUsed
  });

  save();
  render();
}

</script>

</body>
</html>
